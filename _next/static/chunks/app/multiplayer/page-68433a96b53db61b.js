(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[985],{1593:(e,t,r)=>{Promise.resolve().then(r.bind(r,8711))},5695:(e,t,r)=>{"use strict";var o=r(8999);r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}}),r.o(o,"useSearchParams")&&r.d(t,{useSearchParams:function(){return o.useSearchParams}})},8711:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var o=r(5155),s=r(2115),n=r(5695);let a=null,l=!1,c=0,i=()=>"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"ws://localhost:3001":"wss://your-websocket-server.com";function d(){let e=(0,n.useRouter)(),[t,r]=(0,s.useState)([]),[d,m]=(0,s.useState)(""),[u,h]=(0,s.useState)(""),[g,x]=(0,s.useState)(!1),[b,p]=(0,s.useState)(0),[f,w]=(0,s.useState)(null),S=(0,s.useRef)(!0),[v,N]=(0,s.useState)("");(0,s.useEffect)(()=>{N(i())},[]);let y=(0,s.useCallback)(()=>{if(!v)return;let e=Date.now();if(l||a&&a.readyState!==WebSocket.CLOSED||e-c<5e3){console.log("[ROOMLIST] Skipping connection - already connected or recent attempt"),x(!1);return}l=!0,c=e,x(!0),m(""),h("");try{console.log("[ROOMLIST] Creating WebSocket connection (STRICTLY CONTROLLED)");let e=new WebSocket(v);a=e,e.onopen=()=>{if(console.log("[ROOMLIST] Connected to WebSocket server"),l=!1,S.current){x(!1),p(0),f&&(clearTimeout(f),w(null));try{e.send(JSON.stringify({type:"getRooms"}))}catch(e){console.error("[ROOMLIST] Error requesting room list:",e)}}},e.onmessage=e=>{if(S.current)try{let t=JSON.parse(e.data);"roomsList"===t.type?r(t.rooms||[]):"error"===t.type&&(console.error("[ROOMLIST] Server error: ".concat(t.code," - ").concat(t.message)),h("Server error: ".concat(t.code," - ").concat(t.message)))}catch(e){console.error("[ROOMLIST] Error parsing WebSocket message:",e),h("Error parsing message: ".concat(e instanceof Error?e.message:"Unknown error"))}},e.onerror=e=>{console.error("[ROOMLIST] WebSocket error:",e),l=!1,S.current&&(h("Connection error: ".concat(e.type||"Unknown error")),m("Connection error. Please try again."),x(!1))},e.onclose=e=>{if(console.log("[ROOMLIST] WebSocket closed with code ".concat(e.code,", reason: ").concat(e.reason||"No reason provided")),l=!1,a=null,S.current){if(x(!1),1e3!==e.code&&1001!==e.code&&b<3&&S.current){let e=Math.min(1e3*Math.pow(2,b),8e3);console.log("[ROOMLIST] Will attempt to reconnect in ".concat(e,"ms (attempt ").concat(b+1,")"));let t=setTimeout(()=>{S.current&&(p(e=>e+1),y())},e);w(t)}else 1e3!==e.code&&1001!==e.code&&(m("Unable to connect to server. Please refresh the page."),h("WebSocket closed with code ".concat(e.code,", reason: ").concat(e.reason||"No reason provided")))}}}catch(e){console.error("[ROOMLIST] Error creating WebSocket:",e),l=!1,m("Failed to create connection: ".concat(e.message)),h(e.stack||"No stack trace available"),x(!1)}},[v,b,f]);(0,s.useEffect)(()=>{if(S.current=!0,!a||a.readyState!==WebSocket.OPEN&&a.readyState!==WebSocket.CONNECTING)return y(),()=>{S.current=!1,f&&clearTimeout(f),a&&console.log("[ROOMLIST] Global WebSocket exists on unmount, but not closing it")};{console.log("[ROOMLIST] Using existing global WebSocket connection"),x(a.readyState===WebSocket.CONNECTING);let e=a;if(e.readyState===WebSocket.OPEN)try{e.send(JSON.stringify({type:"getRooms"}))}catch(e){console.error("[ROOMLIST] Error requesting room list from existing connection:",e)}let t=e=>{if(S.current)try{let t=JSON.parse(e.data);"roomsList"===t.type&&r(t.rooms||[])}catch(e){console.error("[ROOMLIST] Error parsing message from existing connection:",e)}};return e.addEventListener("message",t),()=>{S.current=!1,e.removeEventListener("message",t),f&&clearTimeout(f)}}},[]),(0,s.useEffect)(()=>{let e=setInterval(()=>{if(a&&a.readyState===WebSocket.OPEN)try{a.send(JSON.stringify({type:"ping"}))}catch(e){console.error("[ROOMLIST] Error sending ping:",e)}},3e4);return()=>{clearInterval(e)}},[]);let j=t=>{e.push("/game?room=".concat(t))};return(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,o.jsx)("h2",{className:"text-xl font-bold text-white",children:"Available Rooms"}),(0,o.jsxs)("button",{onClick:()=>{if(a&&a.readyState===WebSocket.OPEN)try{a.send(JSON.stringify({type:"getRooms"}))}catch(e){console.error("[ROOMLIST] Error requesting room list refresh:",e)}else y()},className:"px-3 py-1 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-all duration-200 text-sm flex items-center gap-1",children:[(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})}),"Refresh"]})]}),g&&(0,o.jsxs)("div",{className:"bg-blue-500/10 border border-blue-500/20 text-blue-400 rounded-lg p-3 text-sm flex items-center justify-center gap-2",children:[(0,o.jsx)("div",{className:"w-4 h-4 border-2 border-blue-400 border-t-transparent rounded-full animate-spin"}),"Connecting to server..."]}),d&&(0,o.jsxs)("div",{className:"bg-red-500/10 border border-red-500/20 text-red-400 rounded-lg p-3 text-sm space-y-2",children:[(0,o.jsx)("div",{children:d}),u&&(0,o.jsx)("div",{className:"text-xs bg-black/20 p-2 rounded overflow-auto max-h-24 text-red-300",children:u}),(0,o.jsx)("button",{onClick:()=>{m(""),h(""),p(0),y()},className:"w-full mt-2 px-3 py-1 bg-red-500/20 hover:bg-red-500/30 text-red-300 rounded text-sm",children:"Try Again"})]}),(0,o.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(e=>(0,o.jsxs)("div",{className:"bg-white/5 backdrop-blur-sm rounded-lg p-4 hover:bg-white/10 transition-all duration-200 cursor-pointer",onClick:()=>j(e.id),children:[(0,o.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,o.jsxs)("h3",{className:"text-white font-medium",children:["Room ",e.id]}),(0,o.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ".concat(e.isGameStarted?"bg-red-500/20 text-red-400":"bg-green-500/20 text-green-400"),children:e.isGameStarted?"In Game":"Waiting"})]}),(0,o.jsxs)("div",{className:"text-white/60 text-sm",children:[e.players.length," player",1!==e.players.length?"s":"",e.creator&&(0,o.jsxs)("span",{className:"text-white/40 ml-1",children:["\xb7 Created by ",e.creator]})]})]},e.id))}),0===t.length&&!d&&!g&&(0,o.jsx)("div",{className:"text-center text-white/60 py-8",children:"No rooms available. Create a new room to start playing!"})]})}function m(e){let{onClose:t}=e,r=(0,n.useRouter)(),[a,l]=(0,s.useState)(""),[c,i]=(0,s.useState)(""),[d,m]=(0,s.useState)(!1);return(0,o.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:(0,o.jsxs)("div",{className:"bg-gradient-to-br from-indigo-900 to-pink-900 rounded-lg p-6 max-w-md w-full",children:[(0,o.jsx)("h2",{className:"text-xl font-bold text-white mb-4",children:"Create New Room"}),(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-white/60 text-sm mb-2",children:"Your Name"}),(0,o.jsx)("input",{type:"text",value:a,onChange:e=>{l(e.target.value),i("")},className:"w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-white/30",placeholder:"Enter your name",maxLength:15,disabled:d}),c&&(0,o.jsx)("p",{className:"text-red-400 text-sm mt-1",children:c}),(0,o.jsx)("p",{className:"text-white/40 text-xs mt-1",children:"This name will be shown to other players in the game"})]}),(0,o.jsxs)("div",{className:"flex gap-3",children:[(0,o.jsx)("button",{onClick:()=>{if(i(""),!a.trim()){i("Please enter your name");return}if(a.trim().length<2){i("Name must be at least 2 characters");return}if(a.trim().length>15){i("Name must be 15 characters or less");return}if(!/^[a-zA-Z0-9_-]+$/.test(a.trim())){i("Name can only contain letters, numbers, underscores and hyphens");return}m(!0);let e=Math.random().toString(36).substring(2,8);try{r.push("/game?room=".concat(e,"&name=").concat(encodeURIComponent(a.trim())))}catch(e){console.error("Error navigating to game page:",e),i("An error occurred while creating the room"),m(!1)}},className:"flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-200 flex justify-center items-center",disabled:d,children:d?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Creating..."]}):"Create Room"}),(0,o.jsx)("button",{onClick:t,className:"px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-all duration-200",disabled:d,children:"Cancel"})]})]})]})})}function u(){let e=(0,n.useRouter)(),[t,r]=(0,s.useState)(!1);return(0,o.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-900 to-pink-900 p-4",children:(0,o.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,o.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,o.jsxs)("button",{onClick:()=>e.back(),className:"px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-all duration-200 flex items-center gap-2",children:[(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z",clipRule:"evenodd"})}),"Back"]}),(0,o.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Multiplayer Rooms"}),(0,o.jsx)("button",{onClick:()=>r(!0),className:"px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-200",children:"Create Room"})]}),(0,o.jsx)(d,{}),t&&(0,o.jsx)(m,{onClose:()=>r(!1)})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(1593)),_N_E=e.O()}]);