(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[925],{5695:(e,t,r)=>{"use strict";var n=r(8999);r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},7004:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var n=r(5155),a=r(2115),s=r(5695);let o=()=>"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"ws://localhost:3001":"wss://your-websocket-server.com",l=new Map,c=new Set,i=new Map;function d(){let e=(0,s.useRouter)(),t=(0,s.useSearchParams)(),r=t.get("room"),d=t.get("name"),u=r&&d?"".concat(r,":").concat(d):null,[g,m]=(0,a.useState)({stage:null,currentCard:null,players:[],isGameStarted:!1,isGameOver:!1,winners:[]}),[h,p]=(0,a.useState)(""),[b,x]=(0,a.useState)(""),[y,w]=(0,a.useState)(!0),[f,v]=(0,a.useState)(0),[N,k]=(0,a.useState)(null),[S,j]=(0,a.useState)(Date.now()),E=(0,a.useRef)(!0),C=(0,a.useCallback)(()=>{if(u&&l.has(u)){let e=l.get(u);if(e.readyState===WebSocket.OPEN)try{console.log("[GAME] Requesting current game state"),e.send(JSON.stringify({type:"getState"})),j(Date.now())}catch(e){console.error("[GAME] Error requesting game state:",e)}}},[u]),G=(0,a.useCallback)(()=>{if(!r||!d||!u){e.push("/multiplayer");return}let t=Date.now();if(c.has(u)||l.has(u)&&l.get(u).readyState!==WebSocket.CLOSED||i.has(u)&&t-i.get(u)<5e3){console.log("[GAME] Skipping connection for ".concat(u," - already in progress or connected")),w(!1);return}w(!0),p(""),x(""),c.add(u),i.set(u,t);let n=o();if(!n){p("Unable to determine WebSocket server URL. Please try again later."),c.delete(u),w(!1);return}let a="".concat(n,"?room=").concat(encodeURIComponent(r),"&name=").concat(encodeURIComponent(d));console.log("[GAME] Connecting to WebSocket: ".concat(a));try{let e=new WebSocket(a);e.onopen=()=>{console.log("[GAME] Successfully connected to game server for room ".concat(r)),c.delete(u),l.set(u,e),E.current&&(w(!1),v(0),N&&(clearTimeout(N),k(null)),setTimeout(()=>{if(E.current&&e.readyState===WebSocket.OPEN)try{e.send(JSON.stringify({type:"getState"})),j(Date.now())}catch(e){console.error("[GAME] Error requesting initial state:",e)}},100))},e.onmessage=e=>{if(E.current)try{let t=JSON.parse(e.data);switch(console.log("[GAME] Received WebSocket message:",t),j(Date.now()),t.type){case"waitingToStart":m(e=>({...e,isGameStarted:!1,players:t.players}));break;case"gameStarted":m(e=>({...e,isGameStarted:!0,stage:t.stage,currentCard:t.currentCard,players:t.players}));break;case"guessResult":m(e=>({...e,players:e.players.map(e=>e.name===t.playerName?{...e,score:t.score}:e),stage:t.nextStage,currentCard:t.currentCard}));break;case"gameOver":m(e=>({...e,isGameOver:!0,winners:t.winners,players:t.scores}));break;case"playerLeft":console.log("[GAME] Player left event received:",t),m(e=>({...e,players:e.players.filter(e=>e.name!==t.playerName)}));break;case"playerJoined":console.log("[GAME] Player joined event received:",t),m(e=>({...e,players:t.players}));break;case"pong":console.log("[GAME] Received pong from server");break;case"error":console.error("[GAME] Server error: ".concat(t.code," - ").concat(t.message)),x("Server error: ".concat(t.code," - ").concat(t.message)),("ROOM_NOT_FOUND"===t.code||"DUPLICATE_CONNECTION"===t.code)&&p("Server error: ".concat(t.message));break;case"roomClosed":p("Room closed: ".concat(t.reason))}}catch(t){console.error("[GAME] Error parsing WebSocket message:",t,"Raw message:",e.data),x("Error parsing message: ".concat(t instanceof Error?t.message:"Unknown error"))}},e.onerror=e=>{console.error("[GAME] WebSocket error:",e),c.delete(u),E.current&&(x("Connection error details: ".concat(e.type)),p("Connection error. Please try again."),w(!1))},e.onclose=e=>{if(console.log("[GAME] WebSocket closed with code ".concat(e.code,", reason: ").concat(e.reason||"No reason provided")),c.delete(u),l.delete(u),!E.current)return;w(!1);let t="";switch(e.code){case 1e3:console.log("[GAME] Clean disconnection");break;case 4e3:t="Missing room ID or player name";break;case 4001:t="You're already connected to this room in another window";break;case 4002:t="The room no longer exists";break;case 4003:t="Server error occurred";break;default:e.code>=4e3?t="Application error: ".concat(e.reason||"Unknown error"):e.code>=1002&&(t="Connection error: "+(e.reason||"Code ".concat(e.code)))}if(t&&(p(t),x("WebSocket closed with code ".concat(e.code,", reason: ").concat(e.reason||"No reason provided"))),!t&&f<5&&E.current){let e=Math.min(1e3*Math.pow(2,f),1e4);console.log("[GAME] Will attempt to reconnect in ".concat(e,"ms (attempt ").concat(f+1,")"));let t=setTimeout(()=>{E.current&&(v(e=>e+1),G())},e);k(t)}else t||p("Unable to connect to server after multiple attempts. Please refresh the page.")}}catch(e){console.error("[GAME] Error creating WebSocket:",e),c.delete(u),p("Failed to create WebSocket connection: ".concat(e.message)),x("Stack: ".concat(e.stack||"No stack trace available")),w(!1)}},[r,d,e,f,N,u]);(0,a.useEffect)(()=>{if(E.current=!0,u&&l.has(u)){let e=l.get(u);if(e.readyState===WebSocket.OPEN){console.log("[GAME] Using existing connection for ".concat(u)),w(!1);try{e.send(JSON.stringify({type:"getState"}))}catch(e){console.error("[GAME] Error requesting state from existing connection:",e)}return()=>{E.current=!1}}}G();let e=setInterval(()=>{Date.now()-S>1e4&&u&&l.has(u)&&l.get(u).readyState===WebSocket.OPEN&&(console.log("[GAME] No activity for 10s, requesting game state"),C())},5e3);return()=>{E.current=!1,clearInterval(e),N&&clearTimeout(N)}},[G,u,S,C]),(0,a.useEffect)(()=>{if(!u)return;let e=setInterval(()=>{if(l.has(u)){let e=l.get(u);if(e.readyState===WebSocket.OPEN)try{e.send(JSON.stringify({type:"ping"}))}catch(e){console.error("[GAME] Error sending ping:",e)}}},3e4);return()=>{clearInterval(e)}},[u]);let A=e=>{if(u){if(l.has(u)){let t=l.get(u);if(t.readyState===WebSocket.OPEN)try{console.log("[GAME] Sending guess: ".concat(e)),t.send(JSON.stringify({type:"guess",guess:e})),j(Date.now())}catch(e){console.error("[GAME] Error sending guess:",e),x("Failed to submit guess: "+(e instanceof Error?e.message:"Unknown error")),C()}else console.warn("[GAME] Cannot send guess - WebSocket not open"),p("Connection to server lost. Attempting to reconnect..."),G()}else console.warn("[GAME] Cannot send guess - No connection found"),p("Connection to server lost. Attempting to reconnect..."),G()}},M=()=>{if(u){if(l.has(u)){let e=l.get(u);if(e.readyState===WebSocket.OPEN)try{console.log("[GAME] Sending startGame message"),e.send(JSON.stringify({type:"startGame"})),j(Date.now())}catch(e){console.error("[GAME] Error starting game:",e),x("Failed to start game: "+(e instanceof Error?e.message:"Unknown error")),C()}else console.warn("[GAME] Cannot start game - WebSocket not open"),p("Connection to server lost. Attempting to reconnect..."),G()}else console.warn("[GAME] Cannot start game - No connection found"),p("Connection to server lost. Attempting to reconnect..."),G()}},O=()=>{if(u&&l.has(u)){let e=l.get(u);e&&(e.readyState===WebSocket.OPEN||e.readyState===WebSocket.CONNECTING)&&e.close(1e3,"User left room"),l.delete(u)}e.push("/multiplayer")};return h?(0,n.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-900 to-pink-900 p-4 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-6 max-w-md w-full text-center",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-white mb-4",children:"Error"}),(0,n.jsx)("p",{className:"text-white/80 mb-2",children:h}),b&&(0,n.jsx)("p",{className:"text-white/60 text-xs mb-4 bg-black/20 p-2 rounded overflow-auto max-h-24",children:b}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("button",{onClick:()=>{p(""),x(""),v(0),G()},className:"w-full px-4 py-2 bg-blue-500/40 hover:bg-blue-500/60 text-white rounded-lg transition-all duration-200",children:"Reconnect"}),(0,n.jsx)("button",{onClick:O,className:"w-full px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-all duration-200",children:"Leave Room"})]})]})}):(0,n.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-900 to-pink-900 p-4",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsxs)("button",{onClick:O,className:"px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-all duration-200 flex items-center gap-2",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z",clipRule:"evenodd"})}),"Leave Room"]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(u&&l.has(u)&&l.get(u).readyState===WebSocket.OPEN?"bg-green-500 animate-pulse":"bg-red-500")}),(0,n.jsxs)("div",{className:"text-white/80",children:["Room: ",r]})]})]}),y&&(0,n.jsxs)("div",{className:"bg-blue-500/10 border border-blue-500/20 text-blue-400 rounded-lg p-3 text-sm flex items-center justify-center gap-2 mb-4",children:[(0,n.jsx)("div",{className:"w-4 h-4 border-2 border-blue-400 border-t-transparent rounded-full animate-spin"}),"Connecting to server..."]}),g.isGameStarted?g.isGameOver?(0,n.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-6 text-center",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-white mb-4",children:"Game Over!"}),(0,n.jsxs)("p",{className:"text-white/80 mb-4",children:["Winner",1!==g.winners.length?"s":"",": ",g.winners.join(", ")]}),(0,n.jsx)("div",{className:"space-y-2 mb-6",children:g.players.map((e,t)=>(0,n.jsxs)("div",{className:"flex justify-between items-center text-white/80",children:[(0,n.jsxs)("span",{children:[e.name," ",e.name===d?"(You)":""]}),(0,n.jsxs)("span",{children:[e.score," points"]})]},t))}),(0,n.jsx)("button",{onClick:M,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-200",children:"Play Again"})]}):(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)("div",{className:"grid grid-cols-2 gap-4",children:g.players.map((e,t)=>(0,n.jsx)("div",{className:"bg-white/5 backdrop-blur-sm rounded-lg p-4",children:(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("span",{className:"text-white",children:[e.name," ",e.name===d?"(You)":""]}),(0,n.jsxs)("span",{className:"text-yellow-400",children:[e.score," points"]})]})},t))}),g.currentCard&&(0,n.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-6 text-center",children:[(0,n.jsxs)("div",{className:"text-4xl mb-4",children:[1===g.currentCard.value?"A":11===g.currentCard.value?"J":12===g.currentCard.value?"Q":13===g.currentCard.value?"K":g.currentCard.value,"hearts"===g.currentCard.suit?"♥":"diamonds"===g.currentCard.suit?"♦":"clubs"===g.currentCard.suit?"♣":"♠"]}),(0,n.jsxs)("div",{className:"space-y-2",children:["red_black"===g.stage&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:()=>A("red"),className:"w-full px-4 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-lg transition-all duration-200",children:"Red"}),(0,n.jsx)("button",{onClick:()=>A("black"),className:"w-full px-4 py-2 bg-gray-500/20 hover:bg-gray-500/30 text-gray-400 rounded-lg transition-all duration-200",children:"Black"})]}),"higher_lower"===g.stage&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:()=>A("higher"),className:"w-full px-4 py-2 bg-green-500/20 hover:bg-green-500/30 text-green-400 rounded-lg transition-all duration-200",children:"Higher"}),(0,n.jsx)("button",{onClick:()=>A("lower"),className:"w-full px-4 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-lg transition-all duration-200",children:"Lower"})]}),"inside_outside"===g.stage&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:()=>A("inside"),className:"w-full px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 rounded-lg transition-all duration-200",children:"Inside"}),(0,n.jsx)("button",{onClick:()=>A("outside"),className:"w-full px-4 py-2 bg-purple-500/20 hover:bg-purple-500/30 text-purple-400 rounded-lg transition-all duration-200",children:"Outside"})]}),"suit"===g.stage&&(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,n.jsx)("button",{onClick:()=>A("hearts"),className:"px-4 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-lg transition-all duration-200",children:"♥ Hearts"}),(0,n.jsx)("button",{onClick:()=>A("diamonds"),className:"px-4 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-lg transition-all duration-200",children:"♦ Diamonds"}),(0,n.jsx)("button",{onClick:()=>A("clubs"),className:"px-4 py-2 bg-gray-500/20 hover:bg-gray-500/30 text-gray-400 rounded-lg transition-all duration-200",children:"♣ Clubs"}),(0,n.jsx)("button",{onClick:()=>A("spades"),className:"px-4 py-2 bg-gray-500/20 hover:bg-gray-500/30 text-gray-400 rounded-lg transition-all duration-200",children:"♠ Spades"})]})]})]})]}):(0,n.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-6 text-center",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-white mb-4",children:"Waiting to Start"}),(0,n.jsxs)("p",{className:"text-white/60 mb-4",children:[g.players.length," player",1!==g.players.length?"s":""," in room"]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("div",{className:"text-white/80 text-sm mb-2",children:"Players:"}),0===g.players.length?(0,n.jsx)("p",{className:"text-white/40 italic",children:"No players have joined yet"}):(0,n.jsx)("div",{className:"space-y-1",children:g.players.map((e,t)=>(0,n.jsxs)("div",{className:"bg-white/5 rounded p-2 text-white/80",children:[e.name," ",e.name===d?"(You)":""]},t))})]}),(0,n.jsx)("button",{onClick:M,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-200",disabled:0===g.players.length,children:"Start Game"})]})]})})}function u(){return(0,n.jsx)(a.Suspense,{fallback:(0,n.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-900 to-pink-900 p-4 flex items-center justify-center",children:(0,n.jsx)("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent rounded-full animate-spin"})}),children:(0,n.jsx)(d,{})})}},9597:(e,t,r)=>{Promise.resolve().then(r.bind(r,7004))}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(9597)),_N_E=e.O()}]);